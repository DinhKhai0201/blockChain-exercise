{"ast":null,"code":"var _jsxFileName = \"/home/kai/train blockchain/blockChain/react-connect-contract/src/App.js\";\nimport { Table, Button, Form } from 'react-bootstrap';\nimport React, { Component } from 'react';\nimport './App.css';\nimport ipfs from './ipfs';\nimport { getContract } from './contractService';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.captureFile = event => {\n      event.stopPropagation();\n      event.preventDefault();\n      const file = event.target.files[0];\n      let reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = () => this.convertToBuffer(reader);\n    };\n\n    this.convertToBuffer = async reader => {\n      //file is converted to a buffer to prepare for uploading to IPFS\n      const buffer = await Buffer.from(reader.result); //set this buffer -using es6 syntax\n\n      this.setState({\n        buffer\n      });\n    };\n\n    this.onSubmit = async event => {\n      event.preventDefault(); //save document to IPFS,return its hash#, and set hash# to state\n      //https://github.com/ipfs/interface-ipfs-core/blob/master/SPEC/FILES.md#add \n\n      await ipfs.add(this.state.buffer, (err, ipfsHash) => {\n        console.log(err, ipfsHash); //setState by setting ipfsHash to ipfsHash[0].hash \n\n        this.setState({\n          url: 'https://gateway.ipfs.io/ipfs/' + ipfsHash[0].hash\n        });\n        this.setState({\n          ipfsHash: ipfsHash[0].hash\n        }); // call Ethereum contract method \"sendHash\" and .send IPFS hash to etheruem contract \n        //return the transaction hash from the ethereum contract\n        //see, this https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#methods-mymethod-send\n\n        const sendHash = (contracts, web3) => {\n          let that = this;\n          contracts.methods.sendHash(this.state.ipfsHash).send({\n            from: this.state.account\n          }, function (err, transactionHash) {\n            console.log(transactionHash);\n            that.setState({\n              transactionHash: transactionHash\n            });\n          });\n        };\n\n        getContract(sendHash);\n      }); //await ipfs.add \n    };\n\n    this.state = {\n      ipfsHash: '',\n      account: '',\n      buffer: '',\n      ethAddress: '',\n      blockNumber: '',\n      transactionHash: '',\n      gasUsed: '',\n      txReceipt: '',\n      url: '',\n      contracts: null,\n      web3: null\n    };\n  }\n\n  componentDidMount() {\n    const ipfs = (contracts, web3) => {\n      this.setState({\n        contracts,\n        web3\n      });\n    };\n\n    getContract(ipfs);\n    let that = this;\n    this.state.contracts.methods.ipfsHash().call({}, function (err, result) {\n      that.setState({\n        ipfsHash: this.state.web3.utils.sha3(result)\n      });\n    });\n    this.state.web3.eth.getCoinbase(function (err, result) {\n      that.setState({\n        account: result\n      });\n    }); // const account = (contracts, web3) => {\n    //   let that = this;\n    //    web3.eth.getCoinbase(function(err, result) {\n    //     that.setState({account: result})\n    //   })\n    // }\n    // getContract(account);\n  }\n\n  //onSubmit \n  //https://gateway.ipfs.io/ipfs/your IPFS hash\n  render() {\n    return React.createElement(\"div\", {\n      className: \"App\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, \" Choose file to send to IPFS \"), React.createElement(Form, {\n      onSubmit: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"file\",\n      onChange: this.captureFile,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }), React.createElement(Button, {\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }, \"Send it\")), React.createElement(Table, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }, React.createElement(\"thead\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99\n      },\n      __self: this\n    }, React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100\n      },\n      __self: this\n    }, \"Tx Receipt Category\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, \" \"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }, \"Values\"))), React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }, \"IPFS Hash stored on Ethereum\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    }, \" : \"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109\n      },\n      __self: this\n    }, this.state.url)), React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, \"Tx # \"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115\n      },\n      __self: this\n    }, \" : \"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116\n      },\n      __self: this\n    }, this.state.transactionHash)))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/home/kai/train blockchain/blockChain/react-connect-contract/src/App.js"],"names":["Table","Button","Form","React","Component","ipfs","getContract","App","constructor","props","captureFile","event","stopPropagation","preventDefault","file","target","files","reader","window","FileReader","readAsArrayBuffer","onloadend","convertToBuffer","buffer","Buffer","from","result","setState","onSubmit","add","state","err","ipfsHash","console","log","url","hash","sendHash","contracts","web3","that","methods","send","account","transactionHash","ethAddress","blockNumber","gasUsed","txReceipt","componentDidMount","call","utils","sha3","eth","getCoinbase","render"],"mappings":"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","sourcesContent":["import {Table, Button, Form } from 'react-bootstrap';\nimport React, { Component } from 'react';\nimport './App.css';\nimport ipfs from './ipfs';\nimport {getContract} from './contractService';\n\nclass App extends Component {\n    constructor(props){\n      super(props);\n      this.state = {\n        ipfsHash:'',\n        account: '',\n        buffer:'',\n        ethAddress:'',\n        blockNumber:'',\n        transactionHash:'',\n        gasUsed:'',\n        txReceipt: '',\n        url:'' ,\n        contracts: null,\n        web3 : null  \n      } \n    }\n    componentDidMount(){\n      const ipfs = (contracts, web3) => {\n        this.setState({\n           contracts, web3\n        })\n      }\n      getContract(ipfs);\n       let that = this;\n         this.state.contracts.methods.ipfsHash().call({},function(err, result) {\n          that.setState({ipfsHash: this.state.web3.utils.sha3(result)})\n        })\n          this.state.web3.eth.getCoinbase(function(err, result) {\n          that.setState({account: result})\n        })\n      // const account = (contracts, web3) => {\n      //   let that = this;\n\n      //    web3.eth.getCoinbase(function(err, result) {\n      //     that.setState({account: result})\n      //   })\n      // }\n      // getContract(account);\n    }\n    captureFile =(event) => {\n      event.stopPropagation()\n      event.preventDefault()\n      const file = event.target.files[0]\n      let reader = new window.FileReader()\n      reader.readAsArrayBuffer(file)\n      reader.onloadend = () => this.convertToBuffer(reader)    \n    };\n\n    convertToBuffer = async(reader) => {\n      //file is converted to a buffer to prepare for uploading to IPFS\n        const buffer = await Buffer.from(reader.result);\n      //set this buffer -using es6 syntax\n        this.setState({buffer});\n    };\n\n    onSubmit = async (event) => {\n      event.preventDefault();\n      //save document to IPFS,return its hash#, and set hash# to state\n      //https://github.com/ipfs/interface-ipfs-core/blob/master/SPEC/FILES.md#add \n      await ipfs.add(this.state.buffer, (err, ipfsHash) => {\n        console.log(err,ipfsHash);\n        //setState by setting ipfsHash to ipfsHash[0].hash \n        this.setState({ url:'https://gateway.ipfs.io/ipfs/' +ipfsHash[0].hash });\n        this.setState({ ipfsHash:ipfsHash[0].hash });\n\n        // call Ethereum contract method \"sendHash\" and .send IPFS hash to etheruem contract \n        //return the transaction hash from the ethereum contract\n        //see, this https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#methods-mymethod-send\n        const sendHash = (contracts, web3) => {\n            let that = this;\n             contracts.methods.sendHash(this.state.ipfsHash).send({\n                from: this.state.account \n             },function(err, transactionHash) {\n             console.log(transactionHash);\n             that.setState({transactionHash: transactionHash});\n            })\n          }\n        getContract(sendHash);\n      }) //await ipfs.add \n    }; //onSubmit \n    //https://gateway.ipfs.io/ipfs/your IPFS hash\n    render() {    \n      return (\n        <div className=\"App\">                 \n                <h3> Choose file to send to IPFS </h3>          \n                <Form onSubmit={this.onSubmit}>            \n                <input type = \"file\" onChange = {this.captureFile}/>             \n                <Button type=\"submit\">Send it</Button>          \n                </Form>\n                <Table >\n                    <thead>                  \n                        <tr>                    \n                            <th>Tx Receipt Category</th>                    \n                            <th> </th>                    \n                            <th>Values</th>                  \n                        </tr>                \n                    </thead>\n                    <tbody>                  \n                        <tr>                    \n                        <td>IPFS Hash stored on Ethereum</td>                    \n                        <td> : </td>                    \n                        <td>\n                        {this.state.url}\n                        </td>                  \n                        </tr>                                  \n                        <tr>                    \n                        <td>Tx # </td>                    \n                        <td> : </td>                    \n                        <td>{this.state.transactionHash}</td>                  \n                        </tr>                \n                    </tbody>            \n                </Table>          \n        </div> \n      );\n    } \n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}